{% extends '_layout.html' %} {% block title %}Forum{% endblock %} {% set
active_page = 'forum' %} {% block body %}

<section class="bg-white p-2">
  <div class="text-center bg-info text-white border border-white border-6 p-3">
    <h1>Forum</h1>
  </div>

  <section class="background-paws p-2">
    <div class="container bg-info p-2">
      <div class="forum-wrapper">
        <!-- Left Sidebar -->
        <div class="forum-sidebar">
          <!--Left Sidebar Button -->
          <div class="forum-sidebar-header justify-content-center">
            <a
              href="{{ url_for('forum_router.post_router.post_form') }}"
              class="btn btn-info has-icon btn-block"
              type="button"
            >
              New Post
            </a>
          </div>
          <!-- end Left Sidebar Button -->

          <!-- Left Sidebar Body -->
          <div class="forum-sidebar-body p-0">
            <div class="p-3 h-50">
              <nav class="nav nav-pills nav-gap-y-1 flex-column">
                {% for key, val in 
                  {'newest': 'Newest', 'no_replies': 'No replies yet', 'most_viewed': 'Most viewed', 'most_replies': 'Most replies'}.items()
                %}
                  <a
                    href="{{ url_for('forum_router.forum', sort_by=key) }}"
                    class="nav-link nav-link-faded has-icon{{ ' active' if key == sort_by else '' }}"
                  >
                    {{ val }}
                  </a>
                {% endfor %}
              </nav>
            </div>
          </div>
          <!-- end Left Sidebar Body -->
        </div>
        <!-- end Left Sidebar -->

        <!-- Main Section -->
        <div class="forum-main">
          <!-- Main Header -->
          <div class="forum-main-header">
            <a
              class="nav-link nav-icon rounded-circle nav-link-faded mr-3 d-md-none"
              href="#"
            >
              <i class="fa-solid fa-angle-right"></i>
            </a>

            <span class="input-icon input-icon-sm ml-auto w-auto m-2">
              <form action="/forum/search" method="get">
                <input type="text",
                  name="search_param",
                  class="form-control form-control-sm bg-gray-200 border-gray-200 shadow-none mb-4 mt-4"
                  placeholder="Search forum" />
              </form>
            </span>
          </div>
          <!--end Main Header-->

          <!-- Forum main body -->

          <!-- Forum List -->
          <div class="forum-main-body p-2 p-sm-3 collapse forum-content show">
            {% for post in posts.items %}
              {% set j_post_link = url_for('forum_router.post_router.post', post_id=post.post_id) %}
              <div
                class="forum-card mb-2"
                ondblclick="window.open('{{ j_post_link }}', '_blank');"
              >
                <div class="forum-card-body p-2 p-sm-3">
                  <div class="media forum-item">
                    <a
                      href="{{ url_for('profile_router.profile_user', username=post.author.username) }}"
                      data-toggle="collapse"
                      data-target=".forum-content"
                    >
                      <img
                        src="{{ post.author.image_path }}"
                        class="mr-3 rounded-circle"
                        width="50"
                        alt="Profile Picture "
                      />
                        {{ post.author.username }}
                      </a>
                    <div class="media-body">
                      <h6>
                        <a
                          href="{{ j_post_link }}"
                          target="_blank"
                          data-toggle="collapse"
                          data-target=".forum-content"
                          class="text-body"
                        >
                          {{ post.title }}
                        </a>
                      </h6>

                      {{ content_markup(post.content) }}

                      <p class="text-muted">
                        <a href="{{ url_for('profile_router.profile_user', username=post.author.username) }}">{{
                          post.author.username }}</a>
                        posted
                        <span class="text-secondary font-weight-bold">{{ post.timestamp }}</span>
                      </p>
                    </div>
                    <div class="text-muted small text-center align-self-center">
                      <span class="d-none d-sm-inline-block"><i class="far fa-eye"></i> {{ post.views }}</span>
                      <span><i class="far fa-comment ms-2"></i> {{ post.replies | length }}</span>
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}

          <!--Pagination-->
          <ul class="pagination pagination-sm pagination-circle justify-content-center mb-0">
            {% for page_num in posts.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
              {% if page_num %}
                {% if posts.page == page_num %}
                  <li class="page-item active">
                    <a class="page-link" href="{{ url_for('forum_router.forum', sort_by=sort_by, page=page_num) }}">{{ page_num }}</a>
                  </li>
                {% else %}
                  <li class="page-item">
                    <a class="page-link" href="{{ url_for('forum_router.forum', sort_by=sort_by, page=page_num) }}">{{ page_num }}</a>
                  </li>
                {% endif %}
              {% else %}
                ...
              {% endif %}
            {% endfor %}
          </ul>
          <!--end Pagination-->
          </div>
        </div>
      </div>
    </div>
  </section>
</section>

{% endblock %}